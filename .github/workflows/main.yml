name: Run signup.py and login.py on schedule

on:
  workflow_dispatch:  # âœ… ìˆ˜ë™ ì‹¤í–‰ ì¶”ê°€
  schedule:
    - cron: '0 10 * * *'  # ë§¤ì¼ ì˜¤ì „ 10ì‹œ ì‹¤í–‰

jobs:
  run-scripts:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.8

      - name: Add Cube-X domain to /etc/hosts (Force)
        run: |
          echo "ğŸ” /etc/hosts ê°•ì œ ì¶”ê°€"
          echo "61.251.164.234 cubex.seowoninfo.com" | sudo tee -a /etc/hosts
          echo "ğŸ” /etc/hosts íŒŒì¼ ë‚´ìš© í™•ì¸"
          cat /etc/hosts

          echo "ğŸ” DNS ìºì‹œ ê°•ì œ ì´ˆê¸°í™”"
          sudo systemctl restart systemd-resolved || sudo systemctl restart networking || echo "DNS ìºì‹œ ì´ˆê¸°í™” ì‹¤íŒ¨"
          resolvectl flush-caches || echo "DNS ìºì‹œ í”ŒëŸ¬ì‹œ ì‹¤íŒ¨"

      - name: Full Network Diagnosis
        run: |
          echo "ğŸ” ë„¤íŠ¸ì›Œí¬ ë° DNS í…ŒìŠ¤íŠ¸ ì‹œì‘"

          echo "ğŸ” DNS í™•ì¸ (dig)"
          dig cubex.seowoninfo.com || echo "âŒ DNS ì¡°íšŒ ì‹¤íŒ¨"

          echo "ğŸ” DNS í™•ì¸ (nslookup)"
          nslookup cubex.seowoninfo.com || echo "âŒ nslookup ì‹¤íŒ¨"

          echo "ğŸ” IP ë° í¬íŠ¸ ì²´í¬ (ping)"
          ping -c 4 cubex.seowoninfo.com || echo "âŒ Ping ì‹¤íŒ¨"

          echo "ğŸ” ì„œë²„ ê²½ë¡œ ì¶”ì  (traceroute)"
          traceroute cubex.seowoninfo.com || echo "âŒ Traceroute ì‹¤íŒ¨"

          echo "ğŸ” HTTP ì—°ê²° í™•ì¸ (curl -v)"
          curl -v --resolve cubex.seowoninfo.com:443:61.251.164.234 https://cubex.seowoninfo.com/auth || echo "âŒ Curl ì‹¤íŒ¨"

          echo "ğŸ” ì§ì ‘ ì—°ê²° ì‹œë„ (wget --spider)"
          wget --spider https://cubex.seowoninfo.com/auth || echo "âŒ Website is not reachable"

          echo "ğŸ” 443 í¬íŠ¸ ì—´ë ¤ ìˆëŠ”ì§€ í™•ì¸ (telnet)"
          (echo quit | telnet cubex.seowoninfo.com 443) || echo "âŒ 443 í¬íŠ¸ ë‹«í˜"

      - name: Install Chrome
        run: |
          sudo apt update
          sudo apt install -y google-chrome-stable

      - name: Install dependencies
        run: pip install selenium chromedriver-autoinstaller requests

      - name: Check Website Availability before running Selenium
        run: |
          echo "ğŸ” Cube-X ì„œë²„ ìµœì¢… ì ê²€"
          if curl -s --head --resolve cubex.seowoninfo.com:443:61.251.164.234 https://cubex.seowoninfo.com/auth | grep "200 OK" > /dev/null; then
            echo "âœ… ì‚¬ì´íŠ¸ ì ‘ê·¼ ê°€ëŠ¥, Selenium ì‹¤í–‰ ê°€ëŠ¥"
          else
            echo "âŒ ì‚¬ì´íŠ¸ ì ‘ê·¼ ë¶ˆê°€, ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ ë°œìƒ"
            echo "ğŸ”¹ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì‹¤í–‰í•  ê²½ìš°, 'self-hosted' Runnerë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."
            exit 1
          fi

      - name: Run signup.py
        run: python signup.py

